bind-key -n C-right   next-window
bind-key -n C-left    previous-window
bind-key -n S-right   select-pane -R
bind-key -n S-left    select-pane -L
bind-key -n S-down    select-pane -D
bind-key -n S-up      select-pane -U
bind-key    r         display-message "Sourcing ~/.tmux.conf" \; source-file ~/.tmux.conf
bind-key    1         select-layout even-horizontal
bind-key    2         select-layout even-vertical
bind-key    3         select-layout main-horizontal
bind-key    4         select-layout main-vertical
bind-key    5         select-layout tiled
bind-key    o         new-window \; split-window \; split-window -h \; select-pane -U \; split-window -h
bind-key -r Up        resize-pane -U
bind-key -r Down      resize-pane -D
bind-key -r Left      resize-pane -L
bind-key -r Right     resize-pane -R
bind-key -n C-s-Left  swap-window -t -1 -d
bind-key -n C-s-Right swap-window -t +1 -d
bind-key -n Pageup    if -F '#{?#{m:*vim*,#{pane_current_command}},0,1}' 'copy-mode -u'

is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
bind -n Pageup if-shell "$is_vim" "send-keys Pageup" "copy-mode -u"

# Open the tmux buffer in vi
bind-key v 'capture-pane' \; \
  capture-pane -S - \; \
  save-buffer /tmp/tmux \; \
  delete-buffer \; \
  send-keys 'nvim /tmp/tmux' Enter

# remap prefix
set -g prefix 'C-\'
unbind C-b
bind 'C-\' send-prefix

# If set to 0, I get 0;10;1c on every 'tmux attach'
# https://github.com/microsoft/WSL/issues/5931
set -s escape-time 20

# Recommended by neovim :checkhealth
set -g focus-events on

# Colored undercurl test: printf '\e[4:3m\e[58:5:32mBlue Undercurled\n\e[0m'
# To display terminal features in effect: tmux display -p '#{client_termfeatures}'
set -s default-terminal "$TERM"
set -as terminal-overrides ',*:Smulx=\E[4::%p1%dm' # undercurl
set -as terminal-overrides ',*:Setulc=\E[58::2::::%p1%{65536}%/%d::%p1%{256}%/%{255}%&%d::%p1%{255}%&%d%;m' # Colored underline/undercurl
#set -as terminal-features ',ms-terminal:RGB'

set -w -g mode-keys vi

set -g pane-active-border-style "bg=red fg=red"
set -g status-right-length 0
set -g status-right ""

set -g window-status-format '#[fg=black]#{window_name}'
set -g window-status-current-style "fg=white bg=blue"

set -g renumber-windows on

# Put the pwd on the right-side of the status line.
# Disabling since, long paths that collide with the
# window names is not handled well.
#set-option -g status-right '#{pane_current_path}'
#set-option -g status-interval 1

# Increase the size of scrollback buffer
set-option -g history-limit 10000

# Just for debug to make sure it's on
# set -g status-right 'Continuum status: #{continuum_status}'
set -g @continuum-restore 'on'
# Units??!! It's minutes.
set -g @continuum-save-interval '60'

# List of plugins
set -g @plugin 'tmux-plugins/tpm'
# Tmux resurrect
# Save:    Prefix + ctrl-s
# Restore: Prefix + ctrl-r
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'nhdaly/tmux-better-mouse-mode'
#set -g @plugin 'tmux-plugins/tmux-yank'

set-option -g mouse on
set -g @scroll-without-changing-pane "on"
set -g @scroll-in-moused-over-pane "on"
set -g @emulate-scroll-for-no-mouse-alternate-buffer "on"

# Make double-click selection use the right word boundaries
set -g word-separators " '\",=[]$*{}<>()^#!`;\t:"

# In gnome-terminal and derivatives (mate-terminal), when selecting text, you
# see a random looking string of text. This fixes it and doesn't seem to have any
# ill effects. https://tinyurl.com/2vd2e2n7 (super long link to askubuntu.com)
#set -g set-clipboard on

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'

bind-key    -T root         MouseDown3Pane         select-pane -t = \; if-shell -F "#{||:#{pane_in_mode},#{mouse_any_flag}}" { send-keys -M } { paste-buffer -p }
bind-key    -T root         DoubleClick1Pane       select-pane -t = \; if-shell -F "#{||:#{pane_in_mode},#{mouse_any_flag}}" { send-keys -M } { copy-mode -H ; send-keys -X select-word ; run-shell -d 0.2 ; send-keys -X copy-pipe-and-cancel }
bind-key    -T root         TripleClick1Pane       select-pane -t = \; if-shell -F "#{||:#{pane_in_mode},#{mouse_any_flag}}" { send-keys -M } { copy-mode -H ; send-keys -X select-line ; run-shell -d 0.2 ; send-keys -X copy-pipe-and-cancel }


#bind -n MouseDown3Pane run "select-pane -t {mouse}; paste-buffer"
#bind -n MouseDown3Pane select-pane \; paste-buffer

# bind -n MouseDown2Pane run "tmux set-buffer -b primary_selection \"$(xsel -o)\"; tmux paste-buffer -b primary_selection; tmux delete-buffer -b primary_selection"

#unbind-key -T root MouseDown1Pane
#unbind-key -T copy-mode MouseDown1Pane
#unbind-key -T copy-mode-vi MouseDown1Pane
#bind-key    -T root         DoubleClick1Pane if-shell -F "#{||:#{pane_in_mode},#{mouse_any_flag}}" "send -M" "copy-mode -H ; send -X select-word ; run -d0.3 ; send -X copy-pipe-and-cancel"
#bind -n MouseDown2Pane select-pane -t= \; paste-buffer
#bind -n MouseDown3Pane select-pane -t= \; paste-buffer
#bind -n MouseDown2Pane select-pane -t=
#bind -n MouseDown3Pane select-pane -t=
#bind -n MouseDown2Pane \
#    select-pane \; \
#    run -b "xclip -o -sel pri | tmux load-buffer - && tmux paste-buffer -s ' '"
#
#    select-pane \; \

#bind -n DoubleClick1Pane \
#    copy-mode -M \; \
#    send-keys -X select-word \; \
#    send-keys -X copy-pipe-no-clear "/bin/cat >/dev/null 2>&1" \; \
#    send-keys -X cancel
#    #send-keys -X copy-pipe-and-cancel "/vols/fast_digital_scratch/fast_cad/tools/foss/xsel/1.2.1/bin/xsel -i -b"
#    #copy-mode -MH \; \

# bind -n MouseDown1Pane select-pane -t= \; run "sleep 0.05" \; select-pane -t=
#
#bind -n MouseDrag1Pane \
#    select-pane \; \
#    copy-mode -MH \; \
#    send-keys -X copy-pipe-no-clear-and-cancel "/vols/fast_digital_scratch/fast_cad/tools/foss/xsel/1.2.1/bin/xsel -i"
#    #send-keys -X clear-selection \; \
#    #send-keys -X cancel
